<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Trashwave Drum Synth</title>
  <style>
    /* === STYLES: –±–∞–∑–æ–≤–∞—è —Å–µ—Ç–∫–∞ –∏ UI === */
    * {
      box-sizing: border-box;
    }
    body {
      background: #000;
      color: #fff;
      font-family: 'VT323', monospace;
      margin: 0;
      padding: 0;
    }
    header {
      text-align: center;
      padding: 2rem;
      border-bottom: 2px dashed #333;
    }
    header h1 {
      font-size: 3rem;
      margin-bottom: 0.5rem;
    }
    header p {
      font-size: 1.2rem;
      color: #aaa;
    }
    .controls {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      justify-content: center;
      padding: 1rem;
      border-bottom: 1px dashed #333;
    }
    .controls button,
    .controls select,
    .controls input[type="number"] {
      background: #000;
      color: #fff;
      border: 2px solid #fff;
      padding: 0.5rem 1rem;
      font-size: 1rem;
      font-family: inherit;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    .controls button:hover,
    .controls select:hover,
    .controls input[type="number"]:hover {
      background: #fff;
      color: #000;
    }
    .grid-section {
      display: flex;
      flex-direction: row;
      padding: 1rem;
      overflow-x: auto;
    }
    .labels {
      display: flex;
      flex-direction: column;
      margin-right: 1rem;
    }
    .label-row {
      height: 28px;
      margin-bottom: 4px;
      white-space: nowrap;
      font-size: 1rem;
    }
    .label-row select {
      margin-left: 0.5rem;
    }
    .grid {
      display: flex;
      flex-direction: column;
    }
    .row {
      display: flex;
    }
    .cell {
      width: 24px;
      height: 24px;
      border: 1px solid #555;
      margin: 1px;
      cursor: pointer;
      background: #111;
      transition: 0.1s;
    }
    .cell.active {
      background: #fff;
    }
    .cell.playing {
      border: 2px solid #0f0;
    }
    #previewPlayer {
      position: fixed;
      bottom: 10px;
      left: 10px;
      z-index: 99;
    }
  </style>
</head>
<body>
  <header>
    <h1>Trashwave Drum Synth</h1>
    <p>Black & White Chaos Sequencer</p>
  </header>

  <div class="controls">
    <button id="playBtn">‚ñ∂ PLAY</button>
    <button id="stopBtn">‚ñ† STOP</button>
    <label>BPM: <input id="bpm" type="number" min="30" max="300" value="120" /></label>
    <label>Synth Type:
      <select id="synthType">
        <option>sine</option>
        <option>square</option>
        <option>sawtooth</option>
        <option>triangle</option>
      </select>
    </label>
    <button id="toggleMetronome">üéö Metronome</button>
  </div>

  <!-- Drum Section -->
  <div class="grid-section">
    <div class="labels" id="drumLabels">
      <div class="label-row">Kick <select class="sample-selector" data-type="kick"></select></div>
      <div class="label-row">Snare <select class="sample-selector" data-type="snare"></select></div>
      <div class="label-row">Hat <select class="sample-selector" data-type="hat"></select></div>
    </div>
    <div id="drumGrid" class="grid"></div>
  </div>

    <!-- Synth Section -->
  <div class="grid-section">
    <div class="labels" id="noteLabels"></div>
    <div id="synthGrid" class="grid"></div>
  </div>

  <!-- Bass / FX / Keys Section -->
  <div class="grid-section">
    <div class="labels" id="bassLabels">
      <div class="label-row">Bass <select class="sample-selector" data-type="bass"></select></div>
      <div class="label-row">FX <select class="sample-selector" data-type="fx"></select></div>
      <div class="label-row">Keys <select class="sample-selector" data-type="keys"></select></div>
    </div>
    <div id="bassGrid" class="grid"></div>
  </div>

  <!-- Hidden Audio Preview Player -->
  <audio id="previewPlayer" controls style="display:none;"></audio>

  <script src="tone.min.js"></script>
  <script>
    // === CONFIGURATION ===
    const steps = 16;
    const synthRows = 18;
    const extraTracks = ['bass', 'fx', 'keys'];
    const drumTracks = ["kick", "snare", "hat"];
    const audioContext = Tone.context;
    let currentStep = 0;
    let metronomeEnabled = false;

    Tone.Transport.bpm.value = 120;
    Tone.Transport.loop = true;
    Tone.Transport.loopEnd = "1m";

    // === DOM ELEMENTS ===
    const bpmInput = document.getElementById("bpm");
    const synthType = document.getElementById("synthType");
    const toggleMetronomeBtn = document.getElementById("toggleMetronome");
    const previewPlayer = document.getElementById("previewPlayer");

    const synthGrid = document.getElementById("synthGrid");
    const drumGrid = document.getElementById("drumGrid");
    const bassGrid = document.getElementById("bassGrid");

    const sampleSelectors = document.querySelectorAll(".sample-selector");

    // === STATE ===
    let synthPattern = Array.from({ length: synthRows }, () => Array(steps).fill(false));
    let drumPattern = drumTracks.map(() => Array(steps).fill(false));
    let bassPattern = extraTracks.map(() => Array(steps).fill(false));
    let noteNames = [];

    const selectedSamples = {
      kick: null,
      snare: null,
      hat: null,
      bass: null,
      fx: null,
      keys: null,
    };

    const players = {
      metronome: new Tone.Player("samples/metronome.wav").toDestination()
    };

    const synth = new Tone.PolySynth(Tone.Synth).toDestination();

    const sampleList = {
      kick: [],
      snare: [],
      hat: [],
      bass: [],
      fx: [],
      keys: [],
    };

        // === FETCH SAMPLE NAMES ===
    const sampleMap = {
      kick: ["Kicks from Dark Web 1.wav", "Kicks from Dark Web 2.wav", "BD-01.wav"],
      snare: ["snare5.wav", "snare6.wav", "SD-09(Echo).wav"],
      hat: ["oh1.wav", "oh2.wav", "Open hat 1.wav"],
      bass: ["8087.wav", "reese1.wav", "Sample pack reese.wav"],
      fx: ["SD-10(Slash).wav", "SD-11(Damage).wav", "SD-13(Dying).wav"],
      keys: ["BD02.wav", "Saple pack pro reese 2.wav"]
    };

    function loadSampleOptions() {
      sampleSelectors.forEach(select => {
        const type = select.dataset.type;
        sampleMap[type].forEach(name => {
          const opt = document.createElement("option");
          opt.value = name;
          opt.textContent = name.replace(/\.(wav|mp3)$/, "");
          select.appendChild(opt);
        });

        // Set default
        selectedSamples[type] = `samples/trashkit/${sampleMap[type][0]}`;
        players[type] = new Tone.Player(selectedSamples[type]).toDestination();

        // Play preview on hover
        select.addEventListener("change", () => {
          selectedSamples[type] = `samples/trashkit/${select.value}`;
          players[type].load(selectedSamples[type]);
        });

        select.addEventListener("mouseover", () => {
          const url = `samples/trashkit/${select.value}`;
          previewPlayer.src = url;
          previewPlayer.play();
        });

        select.addEventListener("mouseleave", () => previewPlayer.pause());
      });
    }

    // === CREATE GRID ===
    function createGrid(container, pattern, labels) {
      container.innerHTML = "";
      pattern.forEach((row, rowIndex) => {
        const rowEl = document.createElement("div");
        rowEl.classList.add("row");
        row.forEach((_, colIndex) => {
          const cell = document.createElement("div");
          cell.classList.add("cell");
          if (colIndex % 4 === 0) cell.classList.add("bar-marker");
          cell.dataset.row = rowIndex;
          cell.dataset.col = colIndex;
          cell.addEventListener("click", () => {
            pattern[rowIndex][colIndex] = !pattern[rowIndex][colIndex];
            cell.classList.toggle("active");
          });
          rowEl.appendChild(cell);
        });
        container.appendChild(rowEl);
      });
    }

    function createNoteLabels() {
      const noteLabels = document.getElementById("noteLabels");
      noteLabels.innerHTML = "";
      const midiStart = 84;
      for (let i = 0; i < synthRows; i++) {
        const midi = midiStart - i;
        const note = Tone.Frequency(midi, "midi").toNote();
        noteNames.push(note);
        const label = document.createElement("div");
        label.textContent = note;
        noteLabels.appendChild(label);
      }
    }

    createGrid(drumGrid, drumPattern);
    createNoteLabels();
    createGrid(synthGrid, synthPattern);
    createGrid(bassGrid, bassPattern);
    loadSampleOptions();
    // === STEP SEQUENCER ===
    Tone.Transport.scheduleRepeat(time => {
      bpmInput.value = Tone.Transport.bpm.value;
      document.querySelectorAll(".cell").forEach(c => c.classList.remove("playing"));

      // DRUMS
      drumPattern.forEach((row, rowIndex) => {
        if (row[currentStep]) {
          const url = selectedSamples[["kick", "snare", "hat"][rowIndex]];
          players[["kick", "snare", "hat"][rowIndex]].start(time);
          drumGrid.children[rowIndex].children[currentStep].classList.add("playing");
        }
      });

      // SYNTH
      const notesToPlay = [];
      synthPattern.forEach((row, y) => {
        if (row[currentStep]) {
          synthGrid.children[y].children[currentStep].classList.add("playing");
          notesToPlay.push(noteNames[y]);
        }
      });

      if (notesToPlay.length) {
        synth.set({ oscillator: { type: synthTypeSelect.value } });
        synth.triggerAttackRelease(notesToPlay, "16n", time);
      }

      // BASS / FX / KEYS
      const bTypes = ["bass", "fx", "keys"];
      bassPattern.forEach((row, rowIndex) => {
        if (row[currentStep]) {
          players[bTypes[rowIndex]].start(time);
          bassGrid.children[rowIndex].children[currentStep].classList.add("playing");
        }
      });

      // METRONOME
      if (metronomeEnabled && currentStep % 4 === 0) {
        players.metronome.start(time);
      }

      currentStep = (currentStep + 1) % steps;
    }, "16n");

    // === CONTROL BUTTONS ===
    playBtn.addEventListener("click", async () => {
      await Tone.start();
      Tone.Transport.bpm.value = parseInt(bpmInput.value, 10);
      currentStep = 0;
      Tone.Transport.start();
      playBtn.classList.add("active");
      stopBtn.classList.remove("active");
    });

    stopBtn.addEventListener("click", () => {
      Tone.Transport.stop();
      currentStep = 0;
      playBtn.classList.remove("active");
      stopBtn.classList.add("active");
    });

    bpmInput.addEventListener("input", () => {
      Tone.Transport.bpm.value = parseInt(bpmInput.value, 10);
    });

    synthTypeSelect.addEventListener("change", () => {
      synth.set({ oscillator: { type: synthTypeSelect.value } });
    });

    toggleMetronomeBtn.addEventListener("click", () => {
      metronomeEnabled = !metronomeEnabled;
      toggleMetronomeBtn.classList.toggle("active", metronomeEnabled);
    });
  </script>
</body>
</html>
