<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>TwoVANDALS</title>
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <link rel="stylesheet" href="style.css" />
  <link href="https://fonts.googleapis.com/css2?family=Archivo+Black&family=VT323&display=swap" rel="stylesheet" />
</head>

<body>

  <div id="loader">
    <div class="glitch-loader">TwoVANDALS</div>
  </div>

  <canvas id="snow-canvas"></canvas>

  <header>
    <div class="logo">TwoVANDALS</div>
    <p class="motto">Trashwave is not a genre. It’s a wound.</p>
    <nav>
      <a href="#music" class="nav-btn">Music</a>
      <a href="#manifest" class="nav-btn">Manifest</a>
      <a href="#contacts" class="nav-btn">Contact</a>
    </nav>
  </header>

  <section class="hero">
    <div class="overlay"></div>
    <div class="hero-content">
      <h1>100+ tracks. No explanation.</h1>
      <a href="https://soundcloud.com/vandalstwo" target="_blank" class="btn pixel-btn">LISTEN</a>
    </div>
  </section>

  <section id="music" class="music">
    <h2>Our Popular Tracks</h2>
    <iframe width="100%" height="450" scrolling="no" frameborder="no" allow="autoplay"
      src="https://w.soundcloud.com/player/?url=https%3A//soundcloud.com/vandalstwo/sets/popular&color=%23000000&auto_play=false&show_artwork=true&show_user=true">
    </iframe>
  </section>

  <section id="manifest" class="manifest">
    <h2>Manifest</h2>
    <p>We promote nothing.<br>We make noise.<br>We live raw.</p>
  </section>

  <section id="contacts" class="contacts">
    <h2>Contact</h2>
    <div class="socials">
      <a href="https://www.instagram.com/twovandals/" target="_blank">Instagram</a>
      <a href="https://open.spotify.com/artist/3KwllIZI6D6aQrffiZUnrZ" target="_blank">Spotify</a>
      <a href="https://soundcloud.com/vandalstwo" target="_blank">SoundCloud</a>
    </div>
    <p>Email: <a href="mailto:vandalstwo@gmail.com">vandalstwo@gmail.com</a></p>

    <div class="discord-links">
      <p><strong>Trashwave Community Discord:</strong> <a href="https://discord.gg/tf2X2ThCBM" target="_blank">Join here</a></p>
      <p><strong>TwoVANDALS Private Server:</strong> <a href="https://discord.gg/CyzsWeQCZ8" target="_blank">Invite-only</a></p>
    </div>
  </section>

  <footer>
    <p>© TwoVANDALS / Noise never sleeps.</p>
  </footer>

<!-- AUDIO PLAYER -->
<div class="audio-player" id="audioPlayer">
  <button id="togglePlayer" class="toggle-btn">▼</button>
  <button id="playPauseBtn">▶ Listen to a curated Trashwave set</button>
  <span id="currentTime">0:00</span>
  <input type="range" id="seekBar" value="0" step="1" />
  <span id="duration">0:00</span>
  <input id="volumeSlider" type="range" min="0" max="1" step="0.01" value="0.5" />
</div>

<audio id="bgTrack" src="ybuocfiewu.mp3" preload="metadata"></audio>

<audio id="clickSound" src="click.mp3" preload="auto"></audio>
  
  <!-- Hidden Easter Eggs -->
  <a href="https://soundcloud.com/deadrazy" class="egg egg-blood" title="deadrazy"></a>
  <a href="https://soundcloud.com/snybun" class="egg egg-water" title="snybun"></a>
  <a href="https://soundcloud.com/princesssguilt" class="egg egg-electric" title="princesssguilt"></a>
  <a href="https://soundcloud.com/3_66_7" class="egg egg-fire" title="3_66_7"></a>
  <a href="https://soundcloud.com/vandal2012" class="egg egg-core" title="vandal2012"></a>

<div class="cassette-player">
  <div class="cassette-body">
    <div class="tape-window">
      <div class="spool left-spool"></div>
      <div class="spool right-spool"></div>
    </div>
  </div>
</div>
  
  <script src="script.js"></script>

  <section id="upload-area">
  <h2>Upload Your Trashwave</h2>
  <input type="file" id="fileInput" accept="audio/*" />
  <button id="uploadBtn">Upload</button>
  <div id="uploadStatus"></div>
  <div id="trackList"></div>
</section>

<script type="module">
  import { createClient } from 'https://esm.sh/@supabase/supabase-js'

  const supabase = createClient(
    'https://qqffjsnlsbzhzhlvbexb.supabase.co',
    'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...'
  );

  const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

  async function listTracks() {
    const { data: files, error } = await supabase.storage.from('tracks').list('', {
      limit: 100
    });

    if (error) return console.error('Fetch error:', error);

    const trackList = document.getElementById('trackList');
    trackList.innerHTML = '';

    for (const file of files) {
      const { data } = supabase.storage.from('tracks').getPublicUrl(file.name);
      const audioUrl = data.publicUrl;

      const title = file.name.replace(/\.[^/.]+$/, "");
      const block = document.createElement('div');
      block.classList.add('track-player');
      block.innerHTML = `
        <h3>${title}</h3>
        <audio src="${audioUrl}"></audio>
        <button class="play-btn">▶</button>
        <input type="range" class="seek-bar" min="0" step="1" value="0" />
        <input type="range" class="volume-bar" min="0" max="1" step="0.01" value="0.5" />
        <canvas class="wave-canvas"></canvas>
      `;
      trackList.appendChild(block);
    }

    initializePlayers();
  }

  function initializePlayers() {
    document.querySelectorAll('.track-player').forEach(player => {
      const audio = player.querySelector('audio');
      const playBtn = player.querySelector('.play-btn');
      const seek = player.querySelector('.seek-bar');
      const volume = player.querySelector('.volume-bar');
      const canvas = player.querySelector('.wave-canvas');
      const ctx = canvas.getContext('2d');

      canvas.width = canvas.offsetWidth;
      canvas.height = canvas.offsetHeight;

      const analyser = audioCtx.createAnalyser();
      analyser.fftSize = 64;
      const source = audioCtx.createMediaElementSource(audio);
      source.connect(analyser);
      analyser.connect(audioCtx.destination);

      const dataArray = new Uint8Array(analyser.frequencyBinCount);

      playBtn.addEventListener('click', () => {
        if (audio.paused) {
          document.querySelectorAll('audio').forEach(a => {
            if (a !== audio) a.pause();
          });
          audio.play();
          playBtn.textContent = '⏸';
          if (audioCtx.state === 'suspended') {
            audioCtx.resume();
          }
        } else {
          audio.pause();
          playBtn.textContent = '▶';
        }
      });

      audio.addEventListener('loadedmetadata', () => {
        seek.max = Math.floor(audio.duration);
      });

      audio.addEventListener('timeupdate', () => {
        seek.value = audio.currentTime;
      });

      seek.addEventListener('input', () => {
        audio.currentTime = seek.value;
      });

      volume.addEventListener('input', () => {
        audio.volume = volume.value;
      });

      function drawWaves() {
        requestAnimationFrame(drawWaves);
        analyser.getByteFrequencyData(dataArray);
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        const barWidth = canvas.width / dataArray.length;
        for (let i = 0; i < dataArray.length; i++) {
          const val = dataArray[i] / 255;
          const height = val * canvas.height;
          ctx.fillStyle = `rgba(0, 255, 0, ${val})`;
          ctx.fillRect(i * barWidth, canvas.height - height, barWidth - 1, height);
        }
      }

      audio.addEventListener('play', () => {
        drawWaves();
      });
    });
  }

  const uploadBtn = document.getElementById('uploadBtn');
  const fileInput = document.getElementById('fileInput');
  const uploadStatus = document.getElementById('uploadStatus');

  uploadBtn.addEventListener('click', async () => {
    const file = fileInput.files[0];
    if (!file) return alert('Choose a file first!');

    const { error } = await supabase.storage.from('tracks').upload(file.name, file, {
      cacheControl: '3600',
      upsert: false
    });

    if (error) {
      uploadStatus.innerText = `Error: ${error.message}`;
    } else {
      uploadStatus.innerText = `Uploaded: ${file.name}`;
      await listTracks();
    }
  });

  listTracks();
</script>

</body>
</html>

<section id="track-feed">
  <h2> Uploaded Trashwave</h2>
  <div id="trackList"></div>
</section>
