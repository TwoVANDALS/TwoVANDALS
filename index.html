<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>TwoVANDALS</title>
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <link rel="stylesheet" href="style.css" />
  <link href="https://fonts.googleapis.com/css2?family=Archivo+Black&family=VT323&display=swap" rel="stylesheet" />
</head>

<body>

  <div id="loader">
    <div class="glitch-loader">TwoVANDALS</div>
  </div>

  <canvas id="snow-canvas"></canvas>

  <header>
    <div class="logo">TwoVANDALS</div>
    <p class="motto">Trashwave is not a genre. It‚Äôs a wound.</p>
    <nav>
      <a href="#music" class="nav-btn">Music</a>
      <a href="#manifest" class="nav-btn">Manifest</a>
      <a href="#contacts" class="nav-btn">Contact</a>
    </nav>
  </header>

  <section class="hero">
    <div class="overlay"></div>
    <div class="hero-content">
      <h1>100+ tracks. No explanation.</h1>
      <a href="https://soundcloud.com/vandalstwo" target="_blank" class="btn pixel-btn">LISTEN</a>
    </div>
  </section>

  <section id="music" class="music">
    <h2>Our Popular Tracks</h2>
    <iframe width="100%" height="450" scrolling="no" frameborder="no" allow="autoplay"
      src="https://w.soundcloud.com/player/?url=https%3A//soundcloud.com/vandalstwo/sets/popular&color=%23000000&auto_play=false&show_artwork=true&show_user=true">
    </iframe>
  </section>

  <section id="manifest" class="manifest">
    <h2>Manifest</h2>
    <p>We promote nothing.<br>We make noise.<br>We live raw.</p>
  </section>

  <section id="contacts" class="contacts">
    <h2>Contact</h2>
    <div class="socials">
      <a href="https://www.instagram.com/twovandals/" target="_blank">Instagram</a>
      <a href="https://open.spotify.com/artist/3KwllIZI6D6aQrffiZUnrZ" target="_blank">Spotify</a>
      <a href="https://soundcloud.com/vandalstwo" target="_blank">SoundCloud</a>
    </div>
    <p>Email: <a href="mailto:vandalstwo@gmail.com">vandalstwo@gmail.com</a></p>

    <div class="discord-links">
      <p><strong>Trashwave Community Discord:</strong> <a href="https://discord.gg/tf2X2ThCBM" target="_blank">Join here</a></p>
      <p><strong>TwoVANDALS Private Server:</strong> <a href="https://discord.gg/CyzsWeQCZ8" target="_blank">Invite-only</a></p>
    </div>
  </section>

  <footer>
    <p>¬© TwoVANDALS / Noise never sleeps.</p>
  </footer>

<!-- AUDIO PLAYER -->
<div class="audio-player" id="audioPlayer">
  <button id="togglePlayer" class="toggle-btn">‚ñº</button>
  <button id="playPauseBtn">‚ñ∂ Listen to a curated Trashwave set</button>
  <span id="currentTime">0:00</span>
  <input type="range" id="seekBar" value="0" step="1" />
  <span id="duration">0:00</span>
  <input id="volumeSlider" type="range" min="0" max="1" step="0.01" value="0.5" />
</div>

<audio id="bgTrack" src="ybuocfiewu.mp3" preload="metadata"></audio>

<audio id="clickSound" src="click.mp3" preload="auto"></audio>
  
  <!-- Hidden Easter Eggs -->
  <a href="https://soundcloud.com/deadrazy" class="egg egg-blood" title="deadrazy"></a>
  <a href="https://soundcloud.com/snybun" class="egg egg-water" title="snybun"></a>
  <a href="https://soundcloud.com/princesssguilt" class="egg egg-electric" title="princesssguilt"></a>
  <a href="https://soundcloud.com/3_66_7" class="egg egg-fire" title="3_66_7"></a>
  <a href="https://soundcloud.com/vandal2012" class="egg egg-core" title="vandal2012"></a>

<div class="cassette-player">
  <div class="cassette-body">
    <div class="tape-window">
      <div class="spool left-spool"></div>
      <div class="spool right-spool"></div>
    </div>
  </div>
</div>
  
  <script src="script.js"></script>

  <section id="upload-area">
  <h2>Upload Your Trashwave</h2>
  <input type="file" id="fileInput" accept="audio/*" />
  <button id="uploadBtn">Upload</button>
  <div id="uploadStatus"></div>
  <ul id="trackList"></ul>
</section>

<script type="module">
  import { createClient } from 'https://esm.sh/@supabase/supabase-js'

  const supabase = createClient(
    'https://qqffjsnlsbzhzhlvbexb.supabase.co',
    'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFxZmZqc25sc2J6aHpobHZiZXhiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDkzMTM1MTksImV4cCI6MjA2NDg4OTUxOX0.LFrwLA5njJYak5RQ25Kd14TZE64HCV8WSsx31riL-0g'
  )
async function listTracks() {
  const { data: files, error } = await supabase.storage.from('tracks').list('', {
    limit: 100,
    sortBy: { column: 'created_at', order: 'desc' }
  });
  if (error) {
    console.error('Fetch error:', error);
    return;
  }

  const trackList = document.getElementById('trackList');
  trackList.innerHTML = '';

  for (const file of files) {
    const { data } = supabase.storage.from('tracks').getPublicUrl(file.name);
    const audioUrl = data.publicUrl;
    const uploadDate = new Date(file.created_at).toLocaleString();

    // üéµ –ù–∞–∑–≤–∞–Ω–∏–µ = –∏–º—è —Ñ–∞–π–ª–∞ –±–µ–∑ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è
    const title = file.name.replace(/\.[^/.]+$/, "");

    // üì¶ –°–æ–∑–¥–∞–µ–º –∫–∞—Å—Ç–æ–º–Ω—ã–π –±–ª–æ–∫
    const block = document.createElement('div');
    block.classList.add('track-player');
    block.innerHTML = `
      <h3>${title}</h3>
      <p class="upload-time">${uploadDate}</p>
      <audio src="${audioUrl}"></audio>
      <button class="play-btn">‚ñ∂</button>
      <input type="range" class="seek-bar" min="0" step="1" value="0" />
      <input type="range" class="volume-bar" min="0" max="1" step="0.01" value="0.5" />
      <canvas class="wave-canvas"></canvas>
    `;
    trackList.appendChild(block);
  }

  initializePlayers(); // –∑–∞–ø—É—Å–∫–∞–µ–º –∫–∞—Å—Ç–æ–º–Ω—É—é –ª–æ–≥–∏–∫—É
}

  function initializePlayers() {
  document.querySelectorAll('.track-player').forEach(player => {
    const audio = player.querySelector('audio');
    const playBtn = player.querySelector('.play-btn');
    const seek = player.querySelector('.seek-bar');
    const volume = player.querySelector('.volume-bar');
    const canvas = player.querySelector('.wave-canvas');
    const ctx = canvas.getContext('2d');

    canvas.width = canvas.offsetWidth;
    canvas.height = canvas.offsetHeight;

    playBtn.addEventListener('click', () => {
      if (audio.paused) {
        document.querySelectorAll('audio').forEach(a => { if (a !== audio) a.pause(); });
        audio.play();
        playBtn.textContent = '‚è∏';
      } else {
        audio.pause();
        playBtn.textContent = '‚ñ∂';
      }
    });

    audio.addEventListener('loadedmetadata', () => {
      seek.max = Math.floor(audio.duration);
    });

    audio.addEventListener('timeupdate', () => {
      seek.value = audio.currentTime;
    });

    seek.addEventListener('input', () => {
      audio.currentTime = seek.value;
    });

    volume.addEventListener('input', () => {
      audio.volume = volume.value;
    });

    // WAVES
    const audioCtx = new AudioContext();
    const analyser = audioCtx.createAnalyser();
    const source = audioCtx.createMediaElementSource(audio);
    const dataArray = new Uint8Array(analyser.frequencyBinCount);
    analyser.fftSize = 64;
    source.connect(analyser);
    analyser.connect(audioCtx.destination);

    function drawWaves() {
      requestAnimationFrame(drawWaves);
      analyser.getByteFrequencyData(dataArray);
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      const barWidth = canvas.width / dataArray.length;
      for (let i = 0; i < dataArray.length; i++) {
        const val = dataArray[i] / 255;
        const height = val * canvas.height;
        ctx.fillStyle = `rgba(0, 255, 0, ${val})`;
        ctx.fillRect(i * barWidth, canvas.height - height, barWidth - 1, height);
      }
    }

    audio.addEventListener('play', () => {
      if (audioCtx.state === 'suspended') {
        audioCtx.resume();
      }
      drawWaves();
    });
  });
}

  
  const uploadBtn = document.getElementById('uploadBtn')
  const fileInput = document.getElementById('fileInput')
  const uploadStatus = document.getElementById('uploadStatus')
  const trackList = document.getElementById('trackList')

  async function listTracks() {
    const { data, error } = await supabase.storage.from('tracks').list('', {
      limit: 100,
      sortBy: { column: 'name', order: 'desc' }
    })

    if (error) return console.error(error)
    trackList.innerHTML = ''
    for (let file of data) {
      const { data: url } = await supabase.storage
        .from('tracks')
        .getPublicUrl(file.name)
      const li = document.createElement('li')
      li.innerHTML = `<audio controls src="${url.publicUrl}"></audio>`
      trackList.appendChild(li)
    }
  }

  uploadBtn.addEventListener('click', async () => {
    const file = fileInput.files[0]
    if (!file) return alert('Choose a file first!')
    const { error } = await supabase.storage
      .from('tracks')
      .upload(file.name, file, {
        cacheControl: '3600',
        upsert: false
      })

    if (error) return uploadStatus.innerText = `Error: ${error.message}`
    uploadStatus.innerText = `Uploaded ${file.name}`
    await listTracks()
  })

  listTracks()
</script>

</body>
</html>

<section id="track-feed">
  <h2> Uploaded Trashwave</h2>
  <div id="trackList"></div>
</section>
